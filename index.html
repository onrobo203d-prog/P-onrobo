<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>スマホ版ラッシュ機シミュレーター</title>
<style>
    body {
        font-family: sans-serif;
        padding: 10px;
        background: #f0f0f0;
        max-width: 600px;
        margin: auto;
    }
    button, input {
        width: 100%;
        font-size: 20px;
        padding: 12px;
        margin: 6px 0;
    }
    .logBox {
        background: #fff;
        padding: 10px;
        border: 1px solid #ccc;
        height: 200px;
        overflow-y: scroll;
        margin-top: 10px;
        font-size: 16px;
        white-space: pre-line;
    }
    h3 {
        margin-top: 20px;
        margin-bottom: 5px;
    }
</style>
</head>
<body>

<h2>スマホ版 ラッシュ機パチンコ</h2>

<p>ポイント: <span id="pt">0</span></p>

<!-- ポイント追加 -->
<input id="addVal" type="number" placeholder="追加ポイント" min="1">
<button onclick="addPoint()">ポイント追加</button>

<!-- 所持ポイントリセット -->
<button onclick="resetPoints()">所持ポイントリセット</button>

<!-- ログリセット -->
<button onclick="resetLogs()">ログリセット</button>

<!-- 任意回数抽選 -->
<input id="manualCount" type="number" placeholder="抽選回数（任意）" min="1">
<button onclick="startManual()">指定回数だけ抽選</button>

<!-- ログ表示枠（3分割） -->
<h3>第一抽選ログ</h3>
<div id="log1" class="logBox"></div>

<h3>第二 / 第三抽選ログ</h3>
<div id="log23" class="logBox"></div>

<h3>第四抽選ログ（ラッシュ）</h3>
<div id="log4" class="logBox"></div>

<script>
let points = 0;

// ログ追加
function log1(msg){ document.getElementById("log1").textContent += msg + "\n"; }
function log23(msg){ document.getElementById("log23").textContent += msg + "\n"; }
function log4(msg){ document.getElementById("log4").textContent += msg + "\n"; }

function update() {
    document.getElementById("pt").textContent = points;
}

function rand(prob) {
    return Math.random() < prob;
}

/* =============================
   ポイント追加
============================= */
function addPoint() {
    const v = parseInt(document.getElementById("addVal").value);
    if (!v || v <= 0) return;
    points += v;
    update();
}

/* 所持ポイントリセット */
function resetPoints() {
    points = 0;
    update();
}

/* ログリセット */
function resetLogs() {
    document.getElementById("log1").textContent = "";
    document.getElementById("log23").textContent = "";
    document.getElementById("log4").textContent = "";
}

/* =============================
   第一抽選
============================= */
function doFirst() {
    if (points < 1) return false;

    points -= 1;
    update();

    if (rand(0.06)) {
        points += 4;
        update();
        log1("第一抽選 → 当たり！（+4pt）");
        return doSecond();
    }
    return true; // ハズレはログ表示なし
}

/* =============================
   第二抽選
============================= */
function doSecond() {
    if (rand(0.005)) {
        points += 100;
        update();
        log23("第二抽選 → 当たり！（+100pt）");
        return doThird();
    } else {
        log23("第二抽選 → ハズレ");
        return true;
    }
}

/* =============================
   第三抽選（ラッシュ突入抽選）
============================= */
function doThird() {
    if (rand(0.5)) {
        log23("第三抽選 → ラッシュ突入！");
        return doFourth();
    } else {
        log23("第三抽選 → ハズレ（終了）");
        return true;
    }
}

/* =============================
   第四抽選（ラッシュループ）
============================= */
function doFourth() {

    const prob = 0.10226; // 1回あたり確率
    const count = 11;      // 11回抽選

    let loop = 0;
    let totalGain = 0;

    while (true) {
        loop++;
        let hit = false;

        for (let i = 1; i <= count; i++) {
            if (rand(prob)) {
                hit = true;
                break;
            }
        }

        if (hit) {
            points += 100;
            totalGain += 100;
            update();
        } else {
            log4(`ラッシュ ${loop - 1} ループ！ 合計 +${totalGain}pt`);
            return true;
        }
    }
}

/* =============================
   指定回数抽選
============================= */
function startManual() {
    let count = parseInt(document.getElementById("manualCount").value);
    if (!count || count <= 0) return;

    for (let i = 0; i < count; i++) {
        if (points <= 0) break;
        doFirst();
    }
}
</script>

</body>
</html>
